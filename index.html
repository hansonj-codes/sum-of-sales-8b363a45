<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Sales Summary 374959384</title>
    <!-- Bootstrap 5 CSS from jsdelivr -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      /* Small custom styles */
      body { padding-top: 4rem; }
      .card { max-width: 540px; margin: 0 auto; }
      #total-sales { font-weight: 700; font-size: 1.5rem; }
    </style>
  </head>
  <body>
    <main class="container">
      <div class="card shadow">
        <div class="card-body">
          <h1 class="card-title">Sales Summary</h1>
          <p class="card-text">Total sales (sum of sales column from data.csv):</p>
          <div id="total-sales" aria-live="polite">Loading...</div>
          <hr />
          <p class="text-muted small">Page title must be "Sales Summary 374959384"</p>
        </div>
      </div>
    </main>

    <!-- Bootstrap JS bundle (includes Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
    // Fetch data.csv relative to root (available in repo attachments when deployed)
    // Parse CSV, sum the 'sales' column, and display it in #total-sales.
    (async function(){
      try {
        // Fetch the CSV file
        const resp = await fetch('data.csv', {cache: 'no-store'});
        if (!resp.ok) throw new Error('Failed to fetch data.csv: ' + resp.status);
        const text = await resp.text();

        // Simple CSV parser for well-formed CSV with header and numeric sales column.
        function parseCSV(csvText) {
          const lines = csvText.trim().split(/\r?\n/);
          if (lines.length === 0) return {headers:[], rows:[]};
          const headers = lines[0].split(',').map(h => h.trim());
          const rows = lines.slice(1).map(line => {
            // handle basic CSV without quoted commas
            const parts = line.split(',').map(p => p.trim());
            const obj = {};
            headers.forEach((h, i) => obj[h] = parts[i] ?? '');
            return obj;
          });
          return {headers, rows};
        }

        const {headers, rows} = parseCSV(text);
        // Ensure 'sales' column exists (case-sensitive per spec)
        if (!headers.includes('sales')) throw new Error('CSV missing "sales" header');

        // Sum sales column, ignoring non-numeric and empty values
        let total = 0;
        for (const row of rows) {
          const raw = row['sales'];
          if (raw === undefined || raw === '') continue;
          // Remove potential thousands separators and normalize decimals
          const normalized = String(raw).replace(/,/g, '');
          const num = Number(normalized);
          if (!Number.isFinite(num)) continue;
          total += num;
        }

        // Format to two decimal places
        const formatted = total.toFixed(2);
        const el = document.querySelector('#total-sales');
        if (el) el.textContent = formatted;
      } catch (err) {
        console.error(err);
        const el = document.querySelector('#total-sales');
        if (el) el.textContent = 'Error computing total';
      }
    })();
    </script>
  </body>
</html>